<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Мои билеты</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f5f6fa; margin:0; }
        header { background:#2f3640; color:white; padding:20px; text-align:center; }
        .container { max-width:900px; margin:auto; padding:20px; }
        .ticket { background:#fff; border-radius:10px; padding:16px; margin-bottom:15px; box-shadow:0 3px 8px rgba(0,0,0,.1);
                  display:flex; justify-content:space-between; align-items:center; }
        .ticket.cancelled { opacity:0.6; background:#f1f2f6; }
        .ticket-info p { margin:4px 0; }
        .status { font-weight:bold; padding:4px 10px; border-radius:6px; font-size:13px; }
        .status.RESERVED { background:#4cd137; color:white; }
        .status.CANCELLED { background:#dcdde1; color:#2f3640; }
        .actions button { background:#e84118; color:white; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; font-weight:bold; }
        .actions button:hover { background:#c23616; }
        .actions button:disabled { background:#bdc3c7; cursor:not-allowed; }
    </style>
</head>
<body>

<header>
    <h1>Мои билеты</h1>
</header>

<div class="container">

    <!-- flash messages -->
    <div th:if="${success}" class="success-box" th:text="${success}"></div>
    <div th:if="${error}" class="error-box" th:text="${error}"></div>

    <div th:each="t : ${tickets}"
         th:class="'ticket ' + (${t.status.name() == 'CANCELLED'} ? 'cancelled' : '')">

        <div class="ticket-info">
            <p><b th:text="${t.trip.route.fromCity}"></b> →
                <b th:text="${t.trip.route.toCity}"></b></p>
            <p>Дата: <span th:text="${#temporals.format(t.trip.departureTime, 'dd-MM-yyyy  HH:mm')}"></span></p>
            <p>Место: <span th:text="${t.seat.seatNumber}"></span></p>
            <span th:class="'status ' + ${t.status.name()}"
                  th:text="${t.status}"></span>
        </div>

        <div class="actions">
            <form th:if="${t.status.name() == 'RESERVED'}"
                  th:action="@{/ticket/{id}/cancel(id=${t.id})}"
                  method="post"
                  onsubmit="return confirmCancel()">
                <button>Отменить</button>
            </form>

            <button th:if="${t.status.name() == 'CANCELLED'}" disabled>
                Отменён
            </button>
        </div>
    </div>
    <a href="/" class="back-link">На главную</a>
</div>

<script>
    function confirmCancel() {
        return confirm("Вы уверены, что хотите отменить билет?");
    }
</script>

</body>
</html>
