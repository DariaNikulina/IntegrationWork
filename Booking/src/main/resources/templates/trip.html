<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Выбор места</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f0f2f5; margin:0; padding:0;}
    header { background:#2f3640; color:white; padding:20px; text-align:center;}
    main { padding:20px; max-width:700px; margin:auto; }
    .trip-info { background:#fff; padding:15px; border-radius:8px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    h3 { margin-bottom:10px; }
    .seats-grid { display:grid; grid-template-columns: repeat(4, 60px); gap:12px; justify-content:center; margin-bottom:20px; }
    .seat {
      padding:12px; text-align:center; border-radius:6px; cursor:pointer; transition: all 0.2s;
      font-weight:bold;
    }
    .seat.free { background-color:#4cd137; color:white; }
    .seat.free:hover { transform: scale(1.1); box-shadow:0 2px 5px rgba(0,0,0,0.2);}
    .seat.booked { background-color:#e84118; color:white; cursor:not-allowed; opacity:0.7; }
    .seat.selected { outline: 3px solid #00a8ff; transform: scale(1.1); }
    form { background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    input, button { padding:10px; width:100%; margin-top:10px; box-sizing:border-box; border-radius:5px; border:1px solid #ccc; }
    button { background-color:#00a8ff; color:white; border:none; font-weight:bold; cursor:pointer; transition: background 0.2s; }
    button:hover { background-color:#0097e6; }
    .back-link { display:inline-block; margin-top:15px; text-decoration:none; color:#00a8ff;}
  </style>
</head>
<body>
<header>
  <h1 th:text="${trip.route.fromCity + ' → ' + trip.route.toCity}">Маршрут</h1>
</header>
<main>
  <div class="trip-info">
    <p>Отправление: <span th:text="${#temporals.format(trip.departureTime, 'dd-MM-yyyy  HH:mm')}"></span></p>
    <p>Цена: <span th:text="${#numbers.formatCurrency(trip.priceRub)}"></span> ₽</p>
  </div>

  <h3>Выберите место</h3>
  <div class="seats-grid">
    <div th:each="s : ${trip.seats}"
         th:id="'seat-'+${s.id}"
         th:text="${s.seatNumber}"
         th:data-seat-id="${s.id}"
         th:class="'seat ' + ${s.status.name.toLowerCase()}">
    </div>
  </div>

  <form th:action="@{/book}" method="post" id="bookingForm">
    <input type="hidden" name="tripId" th:value="${trip.id}"/>
    <input type="hidden" name="seatId" id="seatId"/>
    <label>Имя пассажира</label>
    <input name="passengerName" required/>
    <label>Email</label>
    <input name="email" type="email" required/>
    <button type="submit" id="submitBtn">Заказать</button>
  </form>

  <a th:href="@{/trips(from=${trip.route.fromCity},to=${trip.route.toCity})}" class="back-link">Назад</a>
</main>

<script>
  const seats = document.querySelectorAll('.seat');
  const seatIdInput = document.getElementById('seatId');
  const submitBtn = document.getElementById('submitBtn');

  seats.forEach(seat => {
    if(seat.classList.contains('free')){
      seat.addEventListener('click', () => {
        seats.forEach(s => s.classList.remove('selected'));
        seat.classList.add('selected');
        seatIdInput.value = seat.dataset.seatId;
        submitBtn.disabled = false;
      });
    }
  });
</script>
</body>
</html>
